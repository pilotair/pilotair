import{aV as ye,aW as me,ao as J,r as d,am as m,j as s,aX as _e,as as A,ai as v,ac as ee,aQ as L,az as pe,an as te,aY as ne,au as he,aI as xe,aN as be,aO as je,aq as we,aZ as Pe,a_ as ve}from"./index-CkdniRCF.js";import{S as V,T as Fe}from"./Table-cTBniRIn.js";import{S as Se}from"./index-BGSRdpN6.js";const ke=ye([]);function ze(){const[e,t]=me(ke),{httpGet:n}=J();return d.useEffect(()=>{async function r(){let i=await n("/data-model/components");i=i.sort((o,c)=>o.index-c.index),t(i)}r()},[]),{components:e}}var re=Symbol.for("immer-nothing"),X=Symbol.for("immer-draftable"),_=Symbol.for("immer-state");function h(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var F=Object.getPrototypeOf;function S(e){return!!e&&!!e[_]}function w(e){var t;return e?ie(e)||Array.isArray(e)||!!e[X]||!!((t=e.constructor)!=null&&t[X])||E(e)||N(e):!1}var ge=Object.prototype.constructor.toString();function ie(e){if(!e||typeof e!="object")return!1;const t=F(e);if(t===null)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===ge}function O(e,t){I(e)===0?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function I(e){const t=e[_];return t?t.type_:Array.isArray(e)?1:E(e)?2:N(e)?3:0}function K(e,t){return I(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function se(e,t,n){const r=I(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function Ae(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function E(e){return e instanceof Map}function N(e){return e instanceof Set}function j(e){return e.copy_||e.base_}function q(e,t){if(E(e))return new Map(e);if(N(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=ie(e);if(t===!0||t==="class_only"&&!n){const r=Object.getOwnPropertyDescriptors(e);delete r[_];let i=Reflect.ownKeys(r);for(let o=0;o<i.length;o++){const c=i[o],a=r[c];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[c]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[c]})}return Object.create(F(e),r)}else{const r=F(e);if(r!==null&&n)return{...e};const i=Object.create(r);return Object.assign(i,e)}}function k(e,t=!1){return T(e)||S(e)||!w(e)||(I(e)>1&&(e.set=e.add=e.clear=e.delete=Oe),Object.freeze(e),t&&Object.entries(e).forEach(([n,r])=>k(r,!0))),e}function Oe(){h(2)}function T(e){return Object.isFrozen(e)}var Ce={};function P(e){const t=Ce[e];return t||h(0,e),t}var z;function oe(){return z}function De(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Q(e,t){t&&(P("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function B(e){W(e),e.drafts_.forEach(Ie),e.drafts_=null}function W(e){e===z&&(z=e.parent_)}function Y(e){return z=De(z,e)}function Ie(e){const t=e[_];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Z(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[_].modified_&&(B(t),h(4)),w(e)&&(e=C(t,e),t.parent_||D(t,e)),t.patches_&&P("Patches").generateReplacementPatches_(n[_].base_,e,t.patches_,t.inversePatches_)):e=C(t,n,[]),B(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==re?e:void 0}function C(e,t,n){if(T(t))return t;const r=t[_];if(!r)return O(t,(i,o)=>$(e,r,t,i,o,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return D(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let o=i,c=!1;r.type_===3&&(o=new Set(i),i.clear(),c=!0),O(o,(a,f)=>$(e,r,i,a,f,n,c)),D(e,i,!1),n&&e.patches_&&P("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function $(e,t,n,r,i,o,c){if(S(i)){const a=o&&t&&t.type_!==3&&!K(t.assigned_,r)?o.concat(r):void 0,f=C(e,i,a);if(se(n,r,f),S(f))e.canAutoFreeze_=!1;else return}else c&&n.add(i);if(w(i)&&!T(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;C(e,i),(!t||!t.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(n,r)&&D(e,i)}}function D(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&k(t,n)}function Ee(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:oe(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=H;n&&(i=[r],o=g);const{revoke:c,proxy:a}=Proxy.revocable(i,o);return r.draft_=a,r.revoke_=c,a}var H={get(e,t){if(t===_)return e;const n=j(e);if(!K(n,t))return Ne(e,n,t);const r=n[t];return e.finalized_||!w(r)?r:r===M(e.base_,t)?(R(e),e.copy_[t]=G(r,e)):r},has(e,t){return t in j(e)},ownKeys(e){return Reflect.ownKeys(j(e))},set(e,t,n){const r=ce(j(e),t);if(r!=null&&r.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const i=M(j(e),t),o=i==null?void 0:i[_];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(Ae(n,i)&&(n!==void 0||K(e.base_,t)))return!0;R(e),U(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return M(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,R(e),U(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=j(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty(){h(11)},getPrototypeOf(e){return F(e.base_)},setPrototypeOf(){h(12)}},g={};O(H,(e,t)=>{g[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});g.deleteProperty=function(e,t){return g.set.call(this,e,t,void 0)};g.set=function(e,t,n){return H.set.call(this,e[0],t,n,e[0])};function M(e,t){const n=e[_];return(n?j(n):e)[t]}function Ne(e,t,n){var i;const r=ce(t,n);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(e.draft_):void 0}function ce(e,t){if(!(t in e))return;let n=F(e);for(;n;){const r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=F(n)}}function U(e){e.modified_||(e.modified_=!0,e.parent_&&U(e.parent_))}function R(e){e.copy_||(e.copy_=q(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Te=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if(typeof t=="function"&&typeof n!="function"){const o=n;n=t;const c=this;return function(f=o,...x){return c.produce(f,l=>n.call(this,l,...x))}}typeof n!="function"&&h(6),r!==void 0&&typeof r!="function"&&h(7);let i;if(w(t)){const o=Y(this),c=G(t,void 0);let a=!0;try{i=n(c),a=!1}finally{a?B(o):W(o)}return Q(o,r),Z(i,o)}else if(!t||typeof t!="object"){if(i=n(t),i===void 0&&(i=t),i===re&&(i=void 0),this.autoFreeze_&&k(i,!0),r){const o=[],c=[];P("Patches").generateReplacementPatches_(t,i,o,c),r(o,c)}return i}else h(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(c,...a)=>this.produceWithPatches(c,f=>t(f,...a));let r,i;return[this.produce(t,n,(c,a)=>{r=c,i=a}),r,i]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){w(e)||h(8),S(e)&&(e=Me(e));const t=Y(this),n=G(e,void 0);return n[_].isManual_=!0,W(t),n}finishDraft(e,t){const n=e&&e[_];(!n||!n.isManual_)&&h(9);const{scope_:r}=n;return Q(r,t),Z(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const i=t[n];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}n>-1&&(t=t.slice(n+1));const r=P("Patches").applyPatches_;return S(e)?r(e,t):this.produce(e,i=>r(i,t))}};function G(e,t){const n=E(e)?P("MapSet").proxyMap_(e,t):N(e)?P("MapSet").proxySet_(e,t):Ee(e,t);return(t?t.scope_:oe()).drafts_.push(n),n}function Me(e){return S(e)||h(10,e),ae(e)}function ae(e){if(!w(e)||T(e))return e;const t=e[_];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=q(e,t.scope_.immer_.useStrictShallowCopy_)}else n=q(e,!0);return O(n,(r,i)=>{se(n,r,ae(i))}),t&&(t.finalized_=!1),n}var p=new Te,Re=p.produce;p.produceWithPatches.bind(p);p.setAutoFreeze.bind(p);p.setUseStrictShallowCopy.bind(p);p.applyPatches.bind(p);p.createDraft.bind(p);p.finishDraft.bind(p);function Ke(e){var t=d.useState(function(){return k(typeof e=="function"?e():e,!0)}),n=t[1];return[t[0],d.useCallback(function(r){n(typeof r=="function"?Re(r):k(r))},[])]}function qe({value:e,onChange:t}){const[n,r]=Ke(e||[]),i=[],{status:o}=m.Item.useStatus(),c=d.useRef(!0);d.useEffect(()=>{if(c.current){c.current=!1;return}t==null||t(n)},[n,t]);function a(l){r(u=>{u.splice(l,1)})}function f(){r(l=>{l.push({key:"option"+(l.length+1),value:""})})}function x(l,u,y){r(b=>{const de=b[l];de[u]=y.value})}for(let l=0;l<n.length;l++){const u=n[l];i.push(s.jsxs(_e.Compact,{children:[s.jsx(A,{status:"disable",placeholder:"key",value:u.key,onChange:y=>x(l,"key",y.target)}),s.jsx(A,{status:"disable",placeholder:"value",value:u.value,onChange:y=>x(l,"value",y.target)}),s.jsx(v,{className:"hover-danger-button",onClick:()=>a(l),icon:s.jsx(ee,{})})]},l))}return s.jsxs("div",{className:"space-y-2 "+(o=="error"?"field-valid-error":""),children:[i,s.jsx(v,{icon:s.jsx(L,{}),onClick:f,type:"dashed",className:"!w-full"})]})}function le(){const{components:e}=ze(),t=m.useWatch("type"),[n,r]=d.useState([]),{httpGet:i}=J(),o=d.useMemo(()=>e.find(c=>c.name==t),[t,e]);return d.useEffect(()=>{t=="content"&&i("data-model/content-collections").then(r)},[]),s.jsxs(s.Fragment,{children:[s.jsx(m.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Missing field name"}],children:s.jsx(A,{})}),s.jsx(m.Item,{label:"Type",name:"type",rules:[{required:!0,message:"Missing field type"}],children:s.jsx(V,{options:e.map(c=>({label:c.display,value:c.name}))})}),(o==null?void 0:o.multiple)&&s.jsx(m.Item,{label:"Multiple",name:"multiple",children:s.jsx(Se,{})}),t=="select"&&s.jsx(m.Item,{label:"Options",name:"options",rules:[{required:!0,type:"array",message:"Options can not be empty"},{async validator(c,a){const f=a.map(x=>{var l;return(l=x.key)==null?void 0:l.toLowerCase()});if(f.length!=new Set(f).size)throw new Error},message:"Key must be unique"},{async validator(c,a){if(a.some(f=>!f.key))throw new Error},message:"Key can not be empty"}],children:s.jsx(qe,{})}),t=="content"&&s.jsx(m.Item,{label:"Content",name:"collection",rules:[{required:!0,message:"collection can not be empty"}],children:s.jsx(V,{options:n.map(c=>({label:c.value,value:c.key}))})})]})}function ue(){return s.jsx(s.Fragment,{children:s.jsx(m.Item,{label:"Display",name:"display",children:s.jsx(A,{})})})}function fe(){const[e]=d.useState([]);function t(){}const n=d.useMemo(()=>[],[e]);return s.jsxs(s.Fragment,{children:[n,s.jsx(m.Item,{label:"Add Rule",children:s.jsx(pe,{trigger:["click"],menu:{items:[{label:"Required",key:"required"}]},children:s.jsx(v,{icon:s.jsx(L,{}),onClick:t,type:"dashed",className:"!w-full"})})})]})}function Be({onAddField:e}){const{setOk:t}=d.useContext(te),[n]=m.useForm();t(async()=>{await n.validateFields();const i=n.getFieldsValue();e(i)});const r=[{key:"basic",label:"Basic",children:s.jsx(le,{})},{key:"advanced",label:"Advanced",children:s.jsx(ue,{})},{key:"validation",label:"Validation",children:s.jsx(fe,{})}];return s.jsx(m,{initialValues:{type:"textBox"},labelCol:{span:4},form:n,children:s.jsx(ne,{items:r})})}function We({field:e,updateField:t}){const{setOk:n}=d.useContext(te),[r]=m.useForm();n(async()=>{await r.validateFields();const o=r.getFieldsValue();t(o)});const i=[{key:"basic",label:"Basic",children:s.jsx(le,{})},{key:"advanced",label:"Advanced",children:s.jsx(ue,{})},{key:"validation",label:"Validation",children:s.jsx(fe,{})}];return s.jsx(m,{initialValues:e,labelCol:{span:4},form:r,children:s.jsx(ne,{items:i})})}function He({value:e,onChange:t}){const n=d.useContext(he),[r,i]=d.useState(e||[]),{status:o}=m.Item.useStatus();function c(u){const y=r.filter(b=>b.name!=u.name);i(y),t==null||t(y)}function a(u){const y=[...r,u];i(y),t==null||t(y)}function f(){n.open({title:"New field",children:s.jsx(Be,{onAddField:a})})}function x(u){const y=r.findIndex(b=>b.name==u.name);if(y>-1){r.splice(y,1,u);const b=[...r];i(b),t==null||t(b)}}function l(u){n.open({title:"Edit field",children:s.jsx(We,{field:u,updateField:x})})}return s.jsx("div",{className:o=="error"?"field-valid-error":"",children:s.jsx(Fe,{dataSource:r,size:"small",rowKey:"name",pagination:!1,columns:[{title:"Name",dataIndex:"name"},{title:"Display",dataIndex:"display"},{title:"Control",dataIndex:"controlType"},{title:s.jsx(v,{type:"text",shape:"circle",icon:s.jsx(L,{}),onClick:f}),render(u){return s.jsxs("div",{children:[s.jsx(v,{type:"text",shape:"circle",icon:s.jsx(xe,{}),onClick:()=>l(u)}),s.jsx(v,{type:"text",shape:"circle",danger:!0,icon:s.jsx(ee,{}),onClick:()=>c(u)})]})},fixed:"right",width:100,align:"end"}]})})}function Ve(e){const{activeKey:t}=d.useContext(be),{tabKey:n}=d.useContext(je);we(ve,()=>{Pe(n,t)||e()})}export{He as F,Ve as u};
